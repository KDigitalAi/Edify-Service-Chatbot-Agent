services:
  chatbot:
    # prod-specific container name (different from dev)
    container_name: edify-chatbot-prod

    # build image for production; tag identifies it as prod
    build:
      context: .
      dockerfile: Dockerfile
      args:
        # set default build arg if Dockerfile uses it (app will use env PORT at runtime)
        PORT: ${PORT:-8080}

    image: edify-chatbot:prod
    restart: unless-stopped

    # map host 8081 -> container 8080 (container binds to 8080)
    ports:
      - "8081:8080"

    # production should use env file for secrets/config
    env_file:
      - .env

    # ensure app binds to container port 8080 at runtime
    environment:
      - PORT=8080

    # In production we avoid mounting local code.
    # If you need to mount logs/config, add volumes carefully here.
    # volumes:
    #   - /opt/edify/logs:/app/logs

    command: ["sh", "/app/start.sh"]


    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 5s
      retries: 3

    labels:
      - "com.edify.service=chatbot"
      - "com.edify.env=prod"
      - "com.edify.version=1.0.0"
