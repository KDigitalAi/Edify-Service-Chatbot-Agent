services:
  chatbot:
    # dev-specific container name to avoid collision with prod
    container_name: edify-chatbot-dev

    # build image locally for development; tag identifies it as dev
    build:
      context: .
      dockerfile: Dockerfile
      args:
        # build-time default (kept for compatibility if Dockerfile uses ARG)
        PORT: ${PORT:-8080}

    image: edify-chatbot:dev
    restart: unless-stopped

    # map host 8080 -> container 8080 (internal port the app should listen on)
    ports:
      - "8080:8080"

    # load runtime variables from .env in the repo root
    env_file:
      - .env

    # explicitly set PORT for runtime so app knows which port to bind
    environment:
      - PORT=8080

    # development bind-mount so code changes reflect immediately
    volumes:
      - .:/app

    # development command (keeps same start script)
    command: ./start.sh

    # add a lightweight healthcheck the workflow can rely on
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 5s
      retries: 3

    # useful metadata labels (optional)
    labels:
      - "com.edify.service=chatbot"
      - "com.edify.env=dev"
      - "com.edify.version=1.0.0"
